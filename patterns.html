<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valor - Patterns</title>
    <style>
        .article-content-display {
            white-space: normal;
            font-family: 'Times New Roman', serif;
            line-height: 1.5;
            text-align: justify;
        }

        #content {
            min-height: 150px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Times New Roman', serif;
            white-space: normal;
            overflow-y: auto;
            line-height: 1.5;
        }

        body {
            font-family: 'Times New Roman', serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .navbar {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #ffffff;
            border-bottom: 2px solid #ccc;
            font-weight: bold;
        }
        .nav-links {
            display: flex;
            gap: 20px;
            margin-left: 25px;
        }
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-size: 18px;
            cursor: pointer;
        }
        .search {
            margin-left: auto;
            padding: 10px;
            width: 300px;
            border: 2px solid #aaa;
            border-radius: 5px;
        }
        .container {
            width: 60%;
            margin: 40px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 4px 15px rgba(0,0,0,0.15);
        }
        .article {
            border-bottom: 2px solid #ddd;
            padding: 30px 0;
            transition: background-color 0.3s ease, transform 0.2s ease;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .article:hover {
            background-color: #f0f0f0;
            transform: translateY(-3px);
        }
        .button-group {
            display: flex;
            gap: 10px;
        }
        .delete-button {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .delete-button:hover {
            background-color: #b71c1c;
        }
        .edit-button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .edit-button:hover {
            background-color: #1565c0;
        }
        .blog-post, .article-form {
            display: none;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 4px 15px rgba(0,0,0,0.15);
        }
        .back-button {
            background-color: #6a1b9a;
            color: #ffffff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .back-button:hover {
            background-color: #8e24aa;
        }
        .article-form input, .article-form div {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .article-form button {
            background-color: #6a1b9a;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .article-form button:hover {
            background-color: #8e24aa;
        }
        #content {
            min-height: 150px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Times New Roman', serif;
        }
        #content[contenteditable="true"]:empty:before {
            content: "Start typing...";
            color: #aaa;
        }
        .formatting-toolbar {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .formatting-toolbar button {
            padding: 5px 10px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
            color: black; 
        }
        .formatting-toolbar button:hover {
            background-color: #f0f0f0;
        }
        .formatting-toolbar select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        /* Indentation and alignment CSS for the editor and display */
        #content blockquote {
            margin-left: 20px;
            padding-left: 10px;
            border-left: 3px solid #ddd;
        }
        
        #content div[style*="margin-left"] {
            border-left: 2px solid #eee;
            padding-left: 5px;
        }
        
        /* Explicitly display indentation in the editor */
        #content p {
            margin: 0;
            padding: 5px 0;
            min-height: 1em;
        }
        
        #content p[style*="margin-left"] {
            border-left: 3px solid #ddd;
            padding-left: 10px;
        }
        
        /* Alignment styles */
        #content .text-left {
            text-align: left;
        }
        
        #content .text-center {
            text-align: center;
        }
        
        #content .text-right {
            text-align: right;
        }
        
        #content .text-justify {
            text-align: justify;
        }
        
        /* Indentation level indicators */
        #content .indent-1 { margin-left: 20px; }
        #content .indent-2 { margin-left: 40px; }
        #content .indent-3 { margin-left: 60px; }
        #content .indent-4 { margin-left: 80px; }
        
        /* Tab highlight indicator */
        #content:focus {
            outline: 2px solid #6a1b9a;
            outline-offset: -2px;
        }
    </style>
    <script>
        let articles = JSON.parse(localStorage.getItem("articles")) || [];
        let currentEditIndex = -1;
        let indentLevel = 0; // Track current indentation level

        function saveArticles() {
            localStorage.setItem("articles", JSON.stringify(articles));
        }

        function showBlogPost(index) {
            let article = articles[index];
            document.getElementById('articles').style.display = 'none';
            document.getElementById('article-form').style.display = 'none';

            const postContainer = document.getElementById('blog-post');
            postContainer.innerHTML = `
                <button class="back-button" onclick="showArticleList()">Back to Home</button>
                <h2>${article.title}</h2>
                <small>by ${article.author}</small>
                <p><em>${article.caption}</em></p>
                <div class="article-content-display"></div>
            `;

            const contentDisplay = postContainer.querySelector('.article-content-display');
            contentDisplay.innerHTML = article.content;

            postContainer.style.display = 'block';
        }

        function showArticleList() {
            if (currentEditIndex !== -1) {
            let confirmExit = confirm("You have unsaved changes. Are you sure you want to leave without saving?");
            if (!confirmExit) return; // Stop going back if the user cancels
        }

            document.getElementById('articles').style.display = 'block';
            document.getElementById('blog-post').style.display = 'none';
            document.getElementById('article-form').style.display = 'none';
            renderArticles();
            currentEditIndex = -1; // Reset edit index after returning
        }

        function openArticleForm(isEdit = false, index = -1) {
            document.getElementById('articles').style.display = 'none';
            document.getElementById('blog-post').style.display = 'none';
            
            // Reset form fields
            if (!isEdit) {
                document.getElementById('title').value = '';
                document.getElementById('caption').value = '';
                document.getElementById('author').value = '';
                document.getElementById('content').innerHTML = '';
                document.getElementById('form-title').innerText = 'Add New Article';
                document.getElementById('submit-button').innerText = 'Submit';
                currentEditIndex = -1;
            } else {
                // Fill form with article data for editing
                const article = articles[index];
                document.getElementById('title').value = article.title;
                document.getElementById('caption').value = article.caption;
                document.getElementById('author').value = article.author;
                document.getElementById('content').innerHTML = normalizeHTML(article.content); // Normalize here
                document.getElementById('form-title').innerText = 'Edit Article';
                document.getElementById('submit-button').innerText = 'Update';
                currentEditIndex = index;
            }
            
            document.getElementById('article-form').style.display = 'block';
        }

        function submitArticle() {
            let title = document.getElementById('title').value;
            let caption = document.getElementById('caption').value;
            let author = document.getElementById('author').value;
            let content = document.getElementById('content').innerHTML;

            content = normalizeHTML(content); // Normalize here

            if (title && caption && author && content) {
                if (currentEditIndex === -1) {
                    articles.unshift({ title, caption, author, content });
                } else {
                    articles[currentEditIndex] = { title, caption, author, content };
                }
                
                saveArticles();
                showArticleList();
            }
        }

        function deleteArticle(index, event) {
            // Prevent the click from propagating to the parent (which would open the article)
            event.stopPropagation();
            
            if (confirm('Are you sure you want to delete this article?')) {
                articles.splice(index, 1);
                saveArticles();
                showArticleList();
            }
        }

        function editArticle(index, event) {
            // Prevent the click from propagating to the parent (which would open the article)
            event.stopPropagation();
            openArticleForm(true, index);
        }

        function renderArticles() {
            let container = document.getElementById('articles');
            container.innerHTML = articles.map((article, index) => `
                <div class="article">
                    <div class="article-content" onclick="showBlogPost(${index})">
                        <h2>${article.title}</h2>
                        <p><em>${article.caption}</em></p>
                        <small>by ${article.author}</small>
                    </div>
                    <div class="button-group">
                        <button class="edit-button" onclick="editArticle(${index}, event)">Edit</button>
                        <button class="delete-button" onclick="deleteArticle(${index}, event)">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Text formatting functions
        function formatText(action) {
            document.execCommand(action, false, null);
            document.getElementById('content').focus();
        }

        function indent() {
            // Custom indentation that adds a visible class
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const currentNode = range.startContainer.parentNode;
                
                // Find the closest paragraph or div
                let paragraph = currentNode;
                while (paragraph && paragraph.tagName !== 'P' && paragraph.tagName !== 'DIV' && paragraph.id !== 'content') {
                    paragraph = paragraph.parentNode;
                }
                
                if (paragraph && paragraph.id !== 'content') {
                    indentLevel = (paragraph.getAttribute('data-indent') || 0);
                    indentLevel = parseInt(indentLevel) + 1;
                    if (indentLevel > 4) indentLevel = 4; // Max level
                    
                    paragraph.setAttribute('data-indent', indentLevel);
                    paragraph.className = paragraph.className.replace(/indent-\d/g, '');
                    paragraph.classList.add(`indent-${indentLevel}`);
                } else {
                    // If no paragraph found, use the execCommand
                    document.execCommand('indent', false, null);
                }
            }
        }

        function outdent() {
            // Custom outdent that reduces the visible class
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const currentNode = range.startContainer.parentNode;
                
                // Find the closest paragraph or div
                let paragraph = currentNode;
                while (paragraph && paragraph.tagName !== 'P' && paragraph.tagName !== 'DIV' && paragraph.id !== 'content') {
                    paragraph = paragraph.parentNode;
                }
                
                if (paragraph && paragraph.id !== 'content') {
                    indentLevel = (paragraph.getAttribute('data-indent') || 0);
                    indentLevel = parseInt(indentLevel) - 1;
                    if (indentLevel < 0) indentLevel = 0; // Min level
                    
                    paragraph.setAttribute('data-indent', indentLevel);
                    paragraph.className = paragraph.className.replace(/indent-\d/g, '');
                    if (indentLevel > 0) {
                        paragraph.classList.add(`indent-${indentLevel}`);
                    }
                } else {
                    // If no paragraph found, use the execCommand
                    document.execCommand('outdent', false, null);
                }
            }
        }

        function changeFontSize() {
            const size = document.getElementById('font-size').value;
            formatText('fontSize', size);
        }

        function changeFont() {
            const font = document.getElementById('font-family').value;
            formatText('fontName', font);
        }

        function insertList(type) {
            formatText(type === 'ordered' ? 'insertOrderedList' : 'insertUnorderedList');
        }

       function changeTextAlignment(alignment) {
            // First remove any existing alignment classes
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const currentNode = range.startContainer.parentNode;
                
                // Find the closest paragraph or div
                let paragraph = currentNode;
                while (paragraph && paragraph.tagName !== 'P' && paragraph.tagName !== 'DIV' && paragraph.id !== 'content') {
                    paragraph = paragraph.parentNode;
                }
                
                if (paragraph && paragraph.id !== 'content') {
                    paragraph.classList.remove('text-left', 'text-center', 'text-right', 'text-justify');
                    paragraph.classList.add(`text-${alignment.toLowerCase()}`);
                }
            }
            
            // Also apply the execCommand for better compatibility
            formatText('justify' + alignment);
        }

        function createLink() {
            const url = prompt('Enter URL:', 'http://');
            if (url) {
                formatText('createLink', url);
            }
        }

        function insertImage() {
            const url = prompt('Enter image URL:', 'http://');
            if (url) {
                formatText('insertImage', url);
            }
        }

        // Handle Tab key in the editor
        function handleTabKey(e) {
            if (e.key === 'Tab') {
                // Prevent default tab behavior (which would move focus)
                e.preventDefault();
                
                if (e.shiftKey) {
                    // Shift+Tab = outdent
                    outdent();
                } else {
                    // Tab = indent
                    indent();
                }
            }
        }

        function normalizeHTML(html) {
            // Basic normalization: Remove unnecessary divs and spans, and ensure paragraphs
            // are used for block-level elements.
            html = html.replace(/<div><br><\/div>/gi, '<p><br></p>');
            html = html.replace(/<div>(.*?)<\/div>/gi, '<p>$1</p>');
            html = html.replace(/<span>(.*?)<\/span>/gi, '$1');

            // Remove empty paragraphs
            html = html.replace(/<p><br><\/p>/gi, '');
            html = html.replace(/<p><\/p>/gi, '');

            return html;
        }

        // Load articles when page loads
        document.addEventListener("DOMContentLoaded", function() {
            renderArticles();
            
            const contentEditor = document.getElementById('content');
            
            // Add a listener to create paragraphs on Enter key
            contentEditor.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    // Insert a new paragraph instead of a <br>
                    document.execCommand('formatBlock', false, 'p');
                }
                
                // Handle tab key for indentation
                handleTabKey(e);
            });
            
            // Additional fix for Tab key in Firefox
            contentEditor.addEventListener('keypress', function(e) {
                handleTabKey(e);
            });

            // Intercept the paste event
            contentEditor.addEventListener('paste', function(e) {
                e.preventDefault(); // Prevent default paste behavior

                let pastedData = (e.clipboardData || window.clipboardData).getData('text/html');

                if (!pastedData) {
                    // If no HTML data, paste as plain text
                    pastedData = (e.clipboardData || window.clipboardData).getData('text/plain');
                    document.execCommand('insertText', false, pastedData);
                    return;
                }

                // Clean up the pasted HTML
                pastedData = normalizeHTML(pastedData);

                // Insert the cleaned HTML
                document.execCommand('insertHTML', false, pastedData);
            });
        });
    </script>
</head>
<body>
    <div class="navbar">
        <h2>Valor</h2>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="#">News</a>
            <a href="patterns.html">Pattern</a>
            <a href="#">Assertion</a>
            <a href="#">Critiques</a>
            <a href="#" onclick="openArticleForm()">Add Article</a>
        </div>
        <input type="text" class="search" placeholder="Search Articles">
    </div>
    <div class="container" id="articles"></div>
    <div class="container blog-post" id="blog-post"></div>
    <div class="container article-form" id="article-form">
        <button class="back-button" onclick="showArticleList()">Back to Home</button>
        <h2 id="form-title">Add New Article</h2>
        <input type="text" id="title" placeholder="Title">
        <input type="text" id="caption" placeholder="Caption">
        <input type="text" id="author" placeholder="Author Name">
        
        <div class="formatting-toolbar">
            <button type="button" onclick="formatText('bold')"><b>B</b></button>
            <button type="button" onclick="formatText('italic')"><i>I</i></button>
            <button type="button" onclick="formatText('underline')"><u>U</u></button>
            <button type="button" onclick="formatText('strikethrough')"><s>S</s></button>
            
            <button type="button" onclick="changeTextAlignment('Left')">Left</button>
            <button type="button" onclick="changeTextAlignment('Center')">Center</button>
            <button type="button" onclick="changeTextAlignment('Right')">Right</button>
            <button type="button" onclick="changeTextAlignment('Full')">Justify</button>
            
            <button type="button" onclick="indent()">Indent →</button>
            <button type="button" onclick="outdent()">← Outdent</button>
            
            <button type="button" onclick="insertList('unordered')">• List</button>
            <button type="button" onclick="insertList('ordered')">1. List</button>
            
            <select id="font-family" onchange="changeFont()">
                <option value="">Font</option>
                <option value="Arial">Arial</option>
                <option value="Verdana">Verdana</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Georgia">Georgia</option>
                <option value="Courier New">Courier New</option>
            </select>
            
            <select id="font-size" onchange="changeFontSize()">
                <option value="">Size</option>
                <option value="1">Small</option>
                <option value="3">Normal</option>
                <option value="5">Large</option>
                <option value="7">Huge</option>
            </select>
            
            <button type="button" onclick="createLink()">Link</button>
            <button type="button" onclick="insertImage()">Image</button>
            
            <button type="button" onclick="formatText('removeFormat')">Clear Format</button>
        </div>
        
        <div id="content" contenteditable="true"></div>
        <button id="submit-button" onclick="submitArticle()">Submit</button>
    </div>
</body>
</html>
